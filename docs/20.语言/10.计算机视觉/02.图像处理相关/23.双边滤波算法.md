---
title: 双边滤波算法
date: 2023-05-09 21:56:54
permalink: /language/cv/be424c/
categories:
  - 计算机视觉
  - 图像处理相关
tags:
  - 滤波
  - cv
---

<!-- more -->

## 理论介绍

双边滤波（Bilateral filter）是一种非线性的滤波方法，是结合图像的空间邻近度和像素值相似度的一种折中处理，同时考虑空域信息和灰度相似性，达到保边去噪的目的。具有简单、非迭代、局部的特点。双边滤波器的好处是可以做边缘保存（Edge preserving），一般用高斯滤波去降噪，会较明显地模糊边缘，对于高频细节的保护效果并不明显。

双边滤波器之所以能够做到在平滑去噪的同时还能够很好的保存边缘（Edge Preserve），是由于其滤波器的核由两个函数生成：空间域核和值域核。

### （1）空间域核
由像素位置欧式距离决定的模板权值$\omega _{d}$。

$$
  \omega_d(i,j,k,l)=\exp\ (-\frac{{(i-k)}^2-{(j-l)}^2}{{2\sigma}_d^2})
$$

​::: note
$q(i,j)$为模板窗口的其他系数的坐标；

$p(k,l)$为模板窗口的中心坐标点；

$\sigma _{d}$是空间域上的高斯核函数的标准差，用于控制像素位置的权值。

使用公式生成的滤波器模板和高斯滤波器使用的模板是没有区别的。权值$\omega _{d}$称为定义域核，也称为空间系数、空间域。显示由的计算公式可知，它是计算临近点$q$到中心点$p$临近程度，因此定义域核$\omega _{d}$是用于衡量空间临近的程度。
:::
​
### （2）值域核
由像素值的差值决定的模板权值$\omega _{r}$。
$$
\omega_r(i,j,k,l)=\exp\ (-\frac{\left \| f(i,j)-f(k,l) \right \|}{2\sigma _{r}^{2}})
$$
​::: note
其中，$q(i,j)$为模板窗口的其他系数的坐标，$f(i,j)$表示图像在点处的像素值；

$p(k,l)$为模板窗口的中心坐标点，对应的像素值为$f(k,l)$；

$\sigma _{r}$是像素值域上的高斯核函数的标准差，用于控制像素值的权值。

一般会将权值$\omega _{r}$称为值域核，或像素值域，但不管是值域核$\omega _{r}$还是空间域核$\omega _{d}$，其大小都在[0 1]之间。
:::

最后，将上述两个模板相乘就得到了双边滤波器的模板权值：
​
$$ 
\omega_d(i,j,k,l)=\exp\ (-\frac{{(i-k)}^2-{(j-l)}^2}{{2\sigma}_d^2}-\frac{\left \| f(i,j)-f(k,l) \right \|}{2\sigma _{r}^{2}})
$$

因此，双边滤波器的数据公式可以表示如下：

$$
  g(i,j)=\frac{\sum _{kl}f(k,l)\omega (i,j,k,l)}{\sum _{kl}\omega (i,j,k,l)}
$$

## 理解双边滤波
双边滤波（Bilateral filter）其综合了高斯滤波器和α-截尾均值滤波器的特点，同时考虑了空间域与值域的差别，而高斯滤波器和α均值滤波分别只考虑了空间域和值域差别。高斯滤波器只考虑像素间的欧式距离，其使用的模板系数随着和窗口中心的距离增大而减小；α-截尾均值滤波器则只考虑了像素灰度值之间的差值，去掉α%的最小值和最大值后再计算均值。

### 空域权重$\omega _{d}$和值域权重$\omega _{r}$的意义

空域权重$\omega _{d}$衡量的是两点之间的距离，距离越远权重越低；

值域权重$\omega _{r}$衡量的是两点之间的像素值相似程度，越相似权重越大。

这里从图像的平坦区域和边缘区域定性分析双边滤波的降噪效果：

* 在平坦区域，临近像素的像素值的差值较小，对应值域权重$\omega _{r}$接近于1，此时空域权重起主要作用，相当于直接对此区域进行高斯模糊。因此，平坦区域相当于进行高斯模糊。
* 在边缘区域，临近像素的像素值的差值较大，对应值域权重$\omega _{r}$接近于0，导致此处核函数下降（因$\omega=\omega _{d} \times \omega _{r}$），当前像素受到的影响就越小，从而保持了原始图像的边缘的细节信息。
